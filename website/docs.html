<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ClawTab - Documentation</title>
  <meta name="description" content="ClawTab documentation: configuration, job types, secrets, Telegram, CLI, and architecture.">
  <link rel="icon" type="image/png" href="assets/favicon.png">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
</head>
<body>

<nav class="nav">
  <a href="/" class="nav-logo">
    <img src="assets/app-icon.png" alt="ClawTab">
    ClawTab
  </a>
  <ul class="nav-links">
    <li><a href="/">Home</a></li>
  </ul>
  <a href="docs.html" class="nav-docs">Docs</a>
</nav>

<div class="docs-layout">
  <aside class="docs-sidebar">
    <ul id="sidebar-nav">
      <li><a href="#quick-start" class="active" data-doc="quick-start.md">Quick Start</a></li>
      <li><a href="#configuration" data-doc="configuration.md">Configuration</a></li>
      <li><a href="#job-types" data-doc="job-types.md">Job Types</a></li>
      <li><a href="#secrets" data-doc="secrets.md">Secrets</a></li>
      <li><a href="#telegram" data-doc="telegram.md">Telegram</a></li>
      <li><a href="#cli-tui" data-doc="cli-tui.md">CLI & TUI</a></li>
      <li><a href="#architecture" data-doc="architecture.md">Architecture</a></li>
      <li><a href="#file-reference" data-doc="file-reference.md">File Reference</a></li>
    </ul>
  </aside>

  <main class="docs-content" id="docs-content">
    <p style="color: var(--text-secondary);">Loading documentation...</p>
  </main>
</div>

<footer class="footer">
  <p>Built with Tauri, React, and Rust.</p>
</footer>

<script>
  mermaid.initialize({ startOnLoad: false, theme: 'default' });

  const content = document.getElementById('docs-content');
  const links = document.querySelectorAll('#sidebar-nav a');
  const RAW_BASE = 'https://raw.githubusercontent.com/tonisives/clawdtab/main/docs/';

  async function loadDoc(filename) {
    try {
      // Try local docs/ first (works when served from Docker with docs copied in),
      // fall back to raw GitHub content
      let resp = await fetch('docs/' + filename);
      if (!resp.ok) {
        resp = await fetch(RAW_BASE + filename);
      }
      if (!resp.ok) throw new Error(resp.statusText);
      const md = await resp.text();
      content.innerHTML = marked.parse(md);
      // Convert mermaid code blocks to elements mermaid.js can render
      content.querySelectorAll('code.language-mermaid').forEach(el => {
        const pre = el.parentElement;
        const div = document.createElement('pre');
        div.className = 'mermaid';
        div.textContent = el.textContent;
        pre.replaceWith(div);
      });
      await mermaid.run({ nodes: content.querySelectorAll('.mermaid') });
      content.scrollTo(0, 0);
      window.scrollTo(0, 0);
    } catch (e) {
      content.innerHTML = '<p>Failed to load ' + filename + ': ' + e.message + '</p>';
    }
  }

  function setActive(el) {
    links.forEach(a => a.classList.remove('active'));
    el.classList.add('active');
  }

  links.forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const doc = link.dataset.doc;
      setActive(link);
      loadDoc(doc);
      history.replaceState(null, '', '#' + link.getAttribute('href').slice(1));
    });
  });

  // Load initial doc from hash or default
  const hash = location.hash.slice(1);
  const initial = Array.from(links).find(a => a.getAttribute('href') === '#' + hash);
  if (initial) {
    setActive(initial);
    loadDoc(initial.dataset.doc);
  } else {
    loadDoc('quick-start.md');
  }
</script>

</body>
</html>
